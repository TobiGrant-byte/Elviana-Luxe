<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Admin - Order Management - Elviana Luxe</title>
<link rel="stylesheet" href="styles.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    /* Admin Page Styles */
    .admin-container {
        max-width: 1400px;
        margin: 40px auto;
        padding: 0 5%;
    }
    
    .admin-header {
        text-align: center;
        margin-bottom: 40px;
        padding-bottom: 20px;
        border-bottom: 1px solid #333;
    }
    
    .admin-header h1 {
        color: #fff;
        font-size: 2.5rem;
        margin-bottom: 10px;
    }
    
    .admin-header p {
        color: #aaa;
        font-size: 16px;
    }
    
    /* Login Section */
    .login-section {
        max-width: 400px;
        margin: 100px auto;
        padding: 40px;
        background: rgba(255,255,255,0.02);
        border-radius: 16px;
        border: 1px solid #333;
        text-align: center;
    }
    
    .login-section h2 {
        color: #fff;
        margin-bottom: 30px;
    }
    
    .login-input {
        width: 100%;
        padding: 12px 15px;
        margin-bottom: 20px;
        background: #111;
        border: 1px solid #333;
        border-radius: 8px;
        color: #fff;
        font-size: 16px;
    }
    
    .login-input:focus {
        outline: none;
        border-color: #fff;
    }
    
    .login-btn {
        width: 100%;
        padding: 15px;
        background: #fff;
        color: #000;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .login-btn:hover {
        background: #e0e0e0;
        transform: translateY(-2px);
    }
    
    /* Admin Dashboard */
    .admin-dashboard {
        display: none;
    }
    
    .stats-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
    }
    
    .stat-card {
        background: rgba(255,255,255,0.02);
        padding: 25px;
        border-radius: 12px;
        border: 1px solid #333;
        text-align: center;
    }
    
    .stat-card h3 {
        color: #fff;
        font-size: 14px;
        margin-bottom: 10px;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .stat-number {
        color: #fff;
        font-size: 32px;
        font-weight: bold;
        margin: 10px 0;
    }
    
    .stat-desc {
        color: #aaa;
        font-size: 14px;
    }
    
    /* Orders Table */
    .orders-section {
        margin-top: 40px;
    }
    
    .orders-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .orders-header h2 {
        color: #fff;
        font-size: 24px;
    }
    
    .refresh-btn {
        background: transparent;
        border: 1px solid #333;
        color: #fff;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s ease;
    }
    
    .refresh-btn:hover {
        border-color: #fff;
        color: #fff;
    }
    
    .orders-table-container {
        overflow-x: auto;
        background: rgba(255,255,255,0.02);
        border-radius: 12px;
        border: 1px solid #333;
        padding: 20px;
    }
    
    .orders-table {
        width: 100%;
        border-collapse: collapse;
        color: #fff;
    }
    
    .orders-table th {
        text-align: left;
        padding: 15px;
        border-bottom: 1px solid #333;
        font-weight: bold;
        color: #fff;
        background: rgba(255,255,255,0.05);
    }
    
    .orders-table td {
        padding: 15px;
        border-bottom: 1px solid #333;
        vertical-align: top;
    }
    
    .orders-table tr:hover {
        background: rgba(255,255,255,0.03);
    }
    
    .order-id {
        color: #fff;
        font-weight: bold;
        font-family: monospace;
    }
    
    .customer-info {
        min-width: 200px;
    }
    
    .customer-name {
        color: #fff;
        font-weight: bold;
        margin-bottom: 5px;
    }
    
    .customer-phone, .customer-address {
        color: #aaa;
        font-size: 13px;
        margin: 3px 0;
    }
    
    .order-items {
        min-width: 250px;
    }
    
    .order-item {
        margin-bottom: 8px;
        padding-bottom: 8px;
        border-bottom: 1px dashed #333;
    }
    
    .order-item:last-child {
        border-bottom: none;
    }
    
    .item-name {
        color: #fff;
        font-size: 14px;
    }
    
    .item-details {
        color: #aaa;
        font-size: 12px;
        margin: 3px 0;
    }
    
    .item-quantity {
        color: #fff;
        font-weight: bold;
    }
    
    .order-total {
        color: #fff;
        font-weight: bold;
        font-size: 16px;
    }
    
    .order-date {
        color: #aaa;
        font-size: 13px;
        white-space: nowrap;
    }
    
    /* Status Badges */
    .status-badge {
        display: inline-block;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .status-pending {
        background: rgba(255,193,7,0.2);
        color: #ffc107;
        border: 1px solid #ffc107;
    }
    
    .status-processing {
        background: rgba(0,123,255,0.2);
        color: #007bff;
        border: 1px solid #007bff;
    }
    
    .status-shipped {
        background: rgba(40,167,69,0.2);
        color: #28a745;
        border: 1px solid #28a745;
    }
    
    .status-delivered {
        background: rgba(23,162,184,0.2);
        color: #17a2b8;
        border: 1px solid #17a2b8;
    }
    
    .status-cancelled {
        background: rgba(220,53,69,0.2);
        color: #dc3545;
        border: 1px solid #dc3545;
    }
    
    /* Status Selector */
    .status-select {
        background: #111;
        color: #fff;
        border: 1px solid #333;
        border-radius: 6px;
        padding: 8px 12px;
        font-size: 14px;
        cursor: pointer;
        min-width: 120px;
    }
    
    .status-select:focus {
        outline: none;
        border-color: #fff;
    }
    
    /* Actions */
    .action-buttons {
        display: flex;
        gap: 10px;
    }
    
    .action-btn {
        background: transparent;
        border: 1px solid #333;
        color: #fff;
        width: 36px;
        height: 36px;
        border-radius: 6px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }
    
    .action-btn:hover {
        border-color: #fff;
        transform: translateY(-2px);
    }
    
    .btn-view:hover {
        background: rgba(0,123,255,0.1);
        border-color: #007bff;
        color: #007bff;
    }
    
    .btn-whatsapp:hover {
        background: rgba(37,211,102,0.1);
        border-color: #25D366;
        color: #25D366;
    }
    
    .btn-delete:hover {
        background: rgba(220,53,69,0.1);
        border-color: #dc3545;
        color: #dc3545;
    }
    
    /* Empty State */
    .empty-orders {
        text-align: center;
        padding: 60px 20px;
        color: #aaa;
    }
    
    .empty-orders i {
        font-size: 48px;
        color: #666;
        margin-bottom: 20px;
    }
    
    .empty-orders h3 {
        color: #fff;
        margin-bottom: 10px;
    }
    
    /* Export Section */
    .export-section {
        margin-top: 40px;
        padding: 20px;
        background: rgba(255,255,255,0.02);
        border-radius: 12px;
        border: 1px solid #333;
    }
    
    .export-section h3 {
        color: #fff;
        margin-bottom: 15px;
    }
    
    .export-buttons {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
    }
    
    .export-btn {
        background: transparent;
        border: 1px solid #333;
        color: #fff;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s ease;
    }
    
    .export-btn:hover {
        border-color: #fff;
        background: rgba(255,255,255,0.05);
    }
    
    /* Logout */
    .logout-btn {
        position: fixed;
        top: 20px;
        right: 20px;
        background: rgba(255,255,255,0.1);
        border: 1px solid #333;
        color: #fff;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s ease;
        z-index: 100;
    }
    
    .logout-btn:hover {
        background: rgba(255,255,255,0.2);
        border-color: #fff;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .orders-table th,
        .orders-table td {
            padding: 10px 5px;
            font-size: 14px;
        }
        
        .orders-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 15px;
        }
        
        .customer-info, .order-items {
            min-width: 150px;
        }
        
        .logout-btn {
            position: relative;
            top: 0;
            right: 0;
            margin-bottom: 20px;
        }
    }
</style>
</head>
<body>
<header class="site-header">
<div class="brand">
<img src="Elviana Luxe logo.jpg" alt="Elviana Luxe logo" id="logo" />
<h1>ELVIANA LUXE</h1>
</div>
<nav class="top-links">
<a href="index.html"><i class="fas fa-home"></i> Home</a>
<a href="cart.html"><i class="fas fa-shopping-bag"></i> Cart</a>
<a href="admin.html" style="color: #fff;"><i class="fas fa-lock"></i> Admin</a>
</nav>
</header>

<main class="admin-container">
    <!-- Login Section (Shows First) -->
    <div id="loginSection" class="login-section">
        <h2><i class="fas fa-lock"></i> Admin Access</h2>
        <p style="color: #aaa; margin-bottom: 30px;">Enter the admin password to access order management</p>
        <input type="password" id="adminPassword" class="login-input" placeholder="Enter admin password">
        <button id="loginBtn" class="login-btn">Login to Dashboard</button>
    </div>
    
    <!-- Admin Dashboard (Hidden until login) -->
    <div id="adminDashboard" class="admin-dashboard">
        <div class="admin-header">
            <h1><i class="fas fa-chart-line"></i> Order Management Dashboard</h1>
            <p>View and manage customer orders from Elviana Luxe</p>
        </div>
        
        <!-- Stats Cards -->
        <div class="stats-cards">
            <div class="stat-card">
                <h3>Total Orders</h3>
                <div class="stat-number" id="totalOrders">0</div>
                <p class="stat-desc">All time orders</p>
            </div>
            <div class="stat-card">
                <h3>Pending Orders</h3>
                <div class="stat-number" id="pendingOrders">0</div>
                <p class="stat-desc">Awaiting processing</p>
            </div>
            <div class="stat-card">
                <h3>Revenue</h3>
                <div class="stat-number" id="totalRevenue">$0</div>
                <p class="stat-desc">Total sales value</p>
            </div>
            <div class="stat-card">
                <h3>Today's Orders</h3>
                <div class="stat-number" id="todayOrders">0</div>
                <p class="stat-desc">Orders placed today</p>
            </div>
        </div>
        
        <!-- Orders Table -->
        <div class="orders-section">
            <div class="orders-header">
                <h2><i class="fas fa-shopping-cart"></i> Customer Orders</h2>
                <button id="refreshOrders" class="refresh-btn">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
            
            <div class="orders-table-container">
                <table class="orders-table">
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Customer</th>
                            <th>Date</th>
                            <th>Items</th>
                            <th>Total</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="ordersTableBody">
                        <!-- Orders will be loaded here -->
                    </tbody>
                </table>
                
                <div id="emptyOrders" class="empty-orders" style="display: none;">
                    <i class="fas fa-clipboard-list"></i>
                    <h3>No orders yet</h3>
                    <p>Customer orders will appear here when they place orders through the website.</p>
                </div>
            </div>
        </div>
        
        <!-- Export Section -->
        <div class="export-section">
            <h3><i class="fas fa-download"></i> Export Orders</h3>
            <div class="export-buttons">
                <button id="exportCSV" class="export-btn">
                    <i class="fas fa-file-csv"></i> Export as CSV
                </button>
                <button id="exportJSON" class="export-btn">
                    <i class="fas fa-file-code"></i> Export as JSON
                </button>
                <button id="printOrders" class="export-btn">
                    <i class="fas fa-print"></i> Print Orders
                </button>
                <button id="clearOldOrders" class="export-btn" style="color: #ff6b6b;">
                    <i class="fas fa-trash"></i> Clear Old Orders
                </button>
            </div>
        </div>
    </div>

    <button onclick="enableTextEditing()" style="position: fixed; bottom: 20px; right: 20px; background: #000; color: white; border: 1px solid white; padding: 10px; border-radius: 5px; z-index: 999;">
    ‚úèÔ∏è Edit Text
</button>
    
    <!-- Logout Button (Shows when logged in) -->
    <button id="logoutBtn" class="logout-btn" style="display: none;">
        <i class="fas fa-sign-out-alt"></i> Logout
    </button>
</main>

<footer class="site-footer">
    <p>Elviana Luxe Admin Panel ¬© 2025 ‚Ä¢ Access restricted to authorized personnel only</p>
</footer>

<script>
// Admin Panel JavaScript - UPDATED VERSION
(function() {
    const ADMIN_PASSWORD = "elviana2024";
    const ADMIN_KEY = "elviana_admin_logged_in";
    
    // API Endpoints
    const API_ENDPOINTS = {
        getOrders: 'get_orders.php',
        deleteOrder: 'delete_order.php'
    };
    
    // Check login status
    function checkLoginStatus() {
        const isLoggedIn = localStorage.getItem(ADMIN_KEY) === "true";
        if (isLoggedIn) {
            showDashboard();
        }
    }
    
    // Login function
    document.getElementById('loginBtn')?.addEventListener('click', function() {
        const password = document.getElementById('adminPassword').value;
        
        if (password === ADMIN_PASSWORD) {
            localStorage.setItem(ADMIN_KEY, "true");
            showDashboard();
        } else {
            alert('Incorrect password. Please try again.');
            document.getElementById('adminPassword').value = '';
            document.getElementById('adminPassword').focus();
        }
    });
    
    // Show dashboard
    function showDashboard() {
        document.getElementById('loginSection').style.display = 'none';
        document.getElementById('adminDashboard').style.display = 'block';
        document.getElementById('logoutBtn').style.display = 'flex';
        
        loadOrders();
    }
    
    // Logout function
    document.getElementById('logoutBtn')?.addEventListener('click', function() {
        localStorage.removeItem(ADMIN_KEY);
        location.reload();
    });
    
    // Load orders from PHP backend
    async function loadOrders() {
        try {
            const response = await fetch(API_ENDPOINTS.getOrders);
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }
            
            const ordersData = await response.json();
            // Handle both formats: direct array or wrapped in orders property
            const orders = Array.isArray(ordersData) ? ordersData : (ordersData.orders || []);
            
            displayOrders(orders);
            updateStats(orders);
            
        } catch (error) {
            console.error('Error loading orders:', error);
            document.getElementById('ordersTableBody').innerHTML = `
                <tr>
                    <td colspan="7" style="text-align: center; padding: 40px; color: #ff6b6b;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 24px; margin-bottom: 10px;"></i><br>
                        Cannot connect to server<br>
                        <small style="color: #aaa;">${error.message}</small>
                        <br><br>
                        <button onclick="checkBackendStatus()" style="background: #333; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
                            Check Backend Status
                        </button>
                    </td>
                </tr>
            `;
            document.getElementById('emptyOrders').style.display = 'none';
        }
    }
    
    // Display orders in table
    function displayOrders(orders) {
        const tableBody = document.getElementById('ordersTableBody');
        const emptyOrders = document.getElementById('emptyOrders');
        
        if (!orders || orders.length === 0) {
            tableBody.innerHTML = '';
            emptyOrders.style.display = 'block';
            return;
        }
        
        emptyOrders.style.display = 'none';
        
        // Sort orders by date (newest first)
        orders.sort((a, b) => new Date(b.order_date || b.date) - new Date(a.order_date || a.date));
        
        // Generate table rows
        tableBody.innerHTML = orders.map(order => {
            const orderId = order.id || order.order_id;
            const customerName = order.customer_name || order.customer?.name;
            const customerPhone = order.customer_phone || order.customer?.phone;
            const customerAddress = order.customer_address || order.customer?.address;
            const cartItems = order.cart_items || order.items || [];
            const totalAmount = order.total_amount || order.total || 0;
            const orderDate = order.order_date || order.date;
            const status = order.status || 'pending';
            
            return `
            <tr data-order-id="${orderId}">
                <td>
                    <div class="order-id">#${orderId}</div>
                </td>
                <td class="customer-info">
                    <div class="customer-name">${customerName || 'N/A'}</div>
                    <div class="customer-phone">üì± ${customerPhone || 'Not provided'}</div>
                    <div class="customer-address">üìç ${(customerAddress || '').substring(0, 50)}${customerAddress && customerAddress.length > 50 ? '...' : ''}</div>
                    ${order.customer_email ? `<div class="customer-email" style="color: #888; font-size: 13px;">‚úâÔ∏è ${order.customer_email}</div>` : ''}
                </td>
                <td>
                    <div class="order-date">${new Date(orderDate).toLocaleDateString()}</div>
                    <div class="order-time" style="color: #666; font-size: 12px;">${new Date(orderDate).toLocaleTimeString()}</div>
                </td>
                <td class="order-items">
                    ${cartItems.map(item => `
                        <div class="order-item">
                            <div class="item-name">${item.name || item.product_name}</div>
                            <div class="item-details">${item.selectedColor || item.color || ''} ‚Ä¢ Size ${item.selectedSize || item.size || ''}</div>
                            <div class="item-quantity">Qty: ${item.quantity} √ó ‚Ç¶${item.price || 0}k</div>
                        </div>
                    `).join('')}
                </td>
                <td>
                    <div class="order-total">‚Ç¶${totalAmount}k</div>
                </td>
                <td>
                    <span class="status-badge status-${status}">${status}</span>
                    <select class="status-select" data-order-id="${orderId}" onchange="updateOrderStatus('${orderId}', this.value)">
                        <option value="pending" ${status === 'pending' ? 'selected' : ''}>Pending</option>
                        <option value="processing" ${status === 'processing' ? 'selected' : ''}>Processing</option>
                        <option value="shipped" ${status === 'shipped' ? 'selected' : ''}>Shipped</option>
                        <option value="delivered" ${status === 'delivered' ? 'selected' : ''}>Delivered</option>
                        <option value="cancelled" ${status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                    </select>
                </td>
                <td>
                    <div class="action-buttons">
                        <button class="action-btn btn-view" title="View Details" onclick="viewOrderDetails('${orderId}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="action-btn btn-whatsapp" title="Contact on WhatsApp" onclick="contactCustomer('${orderId}')">
                            <i class="fab fa-whatsapp"></i>
                        </button>
                        <button class="action-btn btn-delete" title="Delete Order" onclick="deleteOrder('${orderId}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            </tr>
            `;
        }).join('');
    }
    
    // Update stats
    function updateStats(orders) {
        const totalOrders = orders.length;
        const pendingOrders = orders.filter(o => (o.status || 'pending') === 'pending').length;
        const totalRevenue = orders.reduce((sum, order) => sum + (order.total_amount || order.total || 0), 0);
        
        // Today's orders
        const today = new Date().toDateString();
        const todayOrders = orders.filter(order => 
            new Date(order.order_date || order.date).toDateString() === today
        ).length;
        
        document.getElementById('totalOrders').textContent = totalOrders;
        document.getElementById('pendingOrders').textContent = pendingOrders;
        document.getElementById('totalRevenue').textContent = `‚Ç¶${totalRevenue}k`;
        document.getElementById('todayOrders').textContent = todayOrders;
    }
    
    // Update order status (saved locally since PHP doesn't support updates)
    window.updateOrderStatus = function(orderId, newStatus) {
        const badge = document.querySelector(`[data-order-id="${orderId}"] .status-badge`);
        if (badge) {
            badge.className = `status-badge status-${newStatus}`;
            badge.textContent = newStatus;
        }
        
        alert(`Order #${orderId} status updated to ${newStatus} (Note: Status changes are saved locally only)`);
    };
    
    // View order details
    window.viewOrderDetails = async function(orderId) {
        try {
            const response = await fetch(API_ENDPOINTS.getOrders);
            const ordersData = await response.json();
            const orders = Array.isArray(ordersData) ? ordersData : (ordersData.orders || []);
            const order = orders.find(o => (o.id || o.order_id) === orderId);
            
            if (order) {
                let details = `üõçÔ∏è ORDER DETAILS\n`;
                details += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
                details += `üìã Order ID: ${orderId}\n`;
                details += `üìÖ Date: ${new Date(order.order_date || order.date).toLocaleString()}\n`;
                details += `üìä Status: ${order.status || 'pending'}\n\n`;
                
                details += `üë§ CUSTOMER INFORMATION\n`;
                details += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
                details += `Name: ${order.customer_name || order.customer?.name}\n`;
                details += `Phone: ${order.customer_phone || order.customer?.phone}\n`;
                details += `Email: ${order.customer_email || order.customer?.email || 'Not provided'}\n`;
                details += `Address: ${order.customer_address || order.customer?.address}\n\n`;
                
                details += `üõí ORDER ITEMS\n`;
                details += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
                
                const cartItems = order.cart_items || order.items || [];
                cartItems.forEach((item, index) => {
                    details += `${index + 1}. ${item.name || 'Item'}\n`;
                    details += `   üé® Color: ${item.selectedColor || item.color || 'N/A'}\n`;
                    details += `   üìè Size: ${item.selectedSize || item.size || 'N/A'}\n`;
                    details += `   üî¢ Quantity: ${item.quantity}\n`;
                    details += `   üíµ Price: ‚Ç¶${item.price || 0}k each\n`;
                    details += `   üì¶ Subtotal: ‚Ç¶${(item.price || 0) * item.quantity}k\n\n`;
                });
                
                details += `üí∞ TOTAL: ‚Ç¶${order.total_amount || order.total || 0}k\n`;
                details += `üí≥ Payment: Cash on Delivery`;
                
                alert(details);
            } else {
                alert('Order not found!');
            }
        } catch (error) {
            alert('Error loading order details: ' + error.message);
        }
    };
    
    // Contact customer on WhatsApp
    window.contactCustomer = async function(orderId) {
        try {
            const response = await fetch(API_ENDPOINTS.getOrders);
            const ordersData = await response.json();
            const orders = Array.isArray(ordersData) ? ordersData : (ordersData.orders || []);
            const order = orders.find(o => (o.id || o.order_id) === orderId);
            
            if (order && order.customer_phone) {
                const phone = order.customer_phone.replace(/\D/g, '');
                let message = `Hello ${order.customer_name || order.customer?.name},\n\n`;
                message += `This is Elviana Luxe regarding your order ${orderId}.\n`;
                message += `Order Status: ${order.status || 'pending'}\n`;
                message += `Total: ‚Ç¶${order.total_amount || order.total || 0}k\n\n`;
                message += `Please let us know if you have any questions.`;
                
                const encodedMessage = encodeURIComponent(message);
                window.open(`https://wa.me/${phone}?text=${encodedMessage}`, '_blank');
            } else {
                alert('Customer phone number not found.');
            }
        } catch (error) {
            alert('Error: ' + error.message);
        }
    };
    
    // Delete order from PHP backend
    window.deleteOrder = async function(orderId) {
        if (!confirm(`Are you sure you want to delete order #${orderId}? This action cannot be undone.`)) {
            return;
        }
        
        try {
            const response = await fetch(API_ENDPOINTS.deleteOrder, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ order_id: orderId })
            });
            
            const result = await response.json();
            
            if (result.success) {
                alert(`Order #${orderId} has been deleted.`);
                loadOrders(); // Refresh the list
            } else {
                alert(`Error: ${result.error}`);
            }
        } catch (error) {
            console.error('Delete error:', error);
            alert('Failed to delete order. Please check console for details.');
        }
    };
    
    // Refresh orders
    document.getElementById('refreshOrders')?.addEventListener('click', function() {
        const btn = this;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
        btn.disabled = true;
        
        loadOrders();
        
        setTimeout(() => {
            btn.innerHTML = '<i class="fas fa-check"></i> Refreshed';
            setTimeout(() => {
                btn.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh';
                btn.disabled = false;
            }, 1500);
        }, 1000);
    });
    
    // Check backend status
    window.checkBackendStatus = function() {
        alert('Checking backend...\n\nMake sure:\n1. PHP files are in the correct folder\n2. "orders.json" file exists\n3. File permissions allow reading/writing\n\nCheck browser console for detailed errors.');
        loadOrders(); // Try again
    };
    
    // Export functions
    document.getElementById('exportJSON')?.addEventListener('click', async function() {
        try {
            const response = await fetch(API_ENDPOINTS.getOrders);
            const ordersData = await response.json();
            const orders = Array.isArray(ordersData) ? ordersData : (ordersData.orders || []);
            
            if (orders.length === 0) {
                alert('No orders to export.');
                return;
            }
            
            const json = JSON.stringify(orders, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `elviana-orders-${new Date().toISOString().slice(0,10)}.json`;
            a.click();
            
            alert(`Exported ${orders.length} orders as JSON.`);
        } catch (error) {
            alert('Error exporting orders: ' + error.message);
        }
    });
    
    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
        checkLoginStatus();
        
        // Allow Enter key for login
        document.getElementById('adminPassword')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('loginBtn').click();
            }
        });
    });
    
})();
</script>
</body>
</html>
